# "Hello World" using the Cert Zero Copy Transport

## Purpose

This repo provides an example publication and subscription pair of applications to send and receive a simple user-defined `HelloWorld` type. As is typical for Connext Cert applications, this example uses Dynamic Participant Static Endpoint (DPSE) discovery over a statically configured UDP transport. User data is communicated over Shared Memory using the Zero Copy Transport.

For convenience, complete source code and a sample `CmakeLists.txt` has been provided.

## Source Overview

A simple `HelloWorld` type, containing an array member, is defined in `HelloWorld.idl`. Note that the idl is annotated with `@SHMEM_REF`.

For the type to be useable by Connext Cert, type-support files must be generated.  These support files are generated by invoking `rtiddsgen` and passing it the specific idl file. `rtiddsgen` can be invoked manually with the following command:

    ${RTIMEHOME}/rtiddsgen/scripts/rtiddsgen -micro -language C HelloWorld.idl

The generated source files are `HelloWorld.c`, `HelloWorldSupport.c`, and `HelloWorldPlugin.c`.  Associated header files are also generated.

The DataWriter and DataReader of the type are managed in `HelloWorld_publisher.c` and `HelloWorld_subscriber.c`, respectively.  The DomainParticipant of each is managed in `HelloWorldApplication.c`.

## Example Files Overview


### HelloWorldApplication.c:
This file contains the logic for creating an application: this includes steps for configuring discovery and creating a DomainParticipant. This file also includes code for registering a type with the DomainParticipant.

The code calls `UDP_InterfaceTable_add_entry()` to statically configure a single loopback interface with the name "lo". Additionally, `dp_qos.transports.enabled_transports`, `dp_qos.discovery.enabled_transports`, and `dp_qos.user_traffic.enabled_transports` are configured to allow discovery to happen over `_udp://` and user traffic to flow over `notif://`.

This file initializes the ZeroCopy transport using `NDDS_Transport_ZeroCopy_initialize()` and `ZCOPY_NotifMechanism_register()`.

### HelloWorld_publisher.c:
This file contains the logic for creating a Publisher and a DataWriter, and sending data.

### HelloWorld_subscriber.c:
This file contains the logic for creating a Subscriber and a DataReader, a DataReaderListener, and listening for data.

### HelloWorldPlugin.c:
This file creates the plugin for the HelloWorld data type.  This file contains the code for serializing and deserializing the HelloWorld type; creating, copying, printing and deleting the HelloWorld type; determining the size of the serialized type, and handling hashing a key; and creating the plug-in. When `@transfer_mode(SHMEM_REF)` is included in the idl, it also includes a function to help and manage the pool of samples in the shared memory.

### HelloWorldSupport.c
This file defines the HelloWorld type and its typed DataWriter, DataReader, and Sequence.

### HelloWorld.c
This file contains the APIs for managing the HelloWorld type.


## Compiling And Running The Example Applications

Before compiling, make sure of the following:
- The desired version of compiler and linker is in your `PATH` environment variable.
- The environment variable `RTIMEHOME` is defined and that it points to Connext Cert installation directory.
- The `RTIMEARCH` environment variable is set to the appropriate architecture: either `x86_64leElfgcc7.3.0CERT` or `armv8leElfqcc8.3.0CERT` for the current release. This denotes the "platform independent" (i.e. independent of the operating system) architecture.
- The `RTIMEOS` environment variable should be set to the OS running on the platform: either `Linux4` or `QOS2.2.1` for this release.

### Compiling For Linux

    cd <your project directory>
    export RTIMEARCH=x86_64leElfgcc7.3.0CERT
    export RTIMEOS=Linux4
    export RTIMEHOME=/path/to/connext/cert
    ${RTIMEHOME}/resource/scripts/rtime-make --target ${RTIMEARCH}-${RTIMEOS} -G "Unix Makefiles" --build -DRTIME_CERT=1 --config Release --source-dir . --delete

### Compiling For QNX

    cd <your project directory>
    export RTIMEARCH=armv8leElfqcc8.3.0CERT
    export RTIMEOS=QOS2.2.1
    export RTIMEHOME=/path/to/connext/cert
    gmake

### Running The Example

Run the subscriber by typing:

    ./objs/${RTIMEARCH}/HelloWorld_subscriber -domain <Domain_ID>

and run the publisher by typing:

    ./objs/${RTIMEARCH}/HelloWorld_publisher -domain <Domain_ID>

**NOTE**: The publisher waits for an user input (Enter Key) after creation to start sending samples.